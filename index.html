<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delicious Ice Cream Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 500;
            background: linear-gradient(135deg, #fff8e7 0%, #ffe5e5 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
        }

        .scene {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .scene.active {
            display: block;
            opacity: 1;
        }

        h1 {
            text-align: center;
            color: #8b6f47;
            margin-bottom: 40px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        /* Scene 1 - Container Choice */
        .container-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            max-width: 600px;
            margin: 0 auto;
        }

        .container-card {
            background: white;
            border-radius: 16px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .container-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transform: rotate(3deg) scale(1.05);
        }

        .container-card.selected {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 200, 0, 0.6);
        }

        .container-icon {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cone-icon {
            width: 0;
            height: 0;
            border-left: 60px solid transparent;
            border-right: 60px solid transparent;
            border-bottom: 120px solid #d4a574;
            position: relative;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }

        .cone-icon::before {
            content: '';
            position: absolute;
            top: 10px;
            left: -50px;
            width: 100px;
            height: 100px;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(139, 111, 71, 0.2) 10px,
                rgba(139, 111, 71, 0.2) 12px
            );
        }

        .cup-icon {
            width: 100px;
            height: 120px;
            background:
                repeating-linear-gradient(
                    90deg,
                    #a8d8ea 0px,
                    #a8d8ea 8px,
                    #95cee3 8px,
                    #95cee3 16px
                ),
                linear-gradient(180deg, #a8d8ea 0%, #7bbfd9 100%);
            border-radius: 0 0 40px 40px;
            position: relative;
            box-shadow:
                inset 0 -10px 20px rgba(0,0,0,0.15),
                inset -3px 0 8px rgba(0,0,0,0.1),
                inset 3px 0 8px rgba(255,255,255,0.3);
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }

        .cup-icon::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            height: 20px;
            background: linear-gradient(180deg, #b8e3f0 0%, #a8d8ea 100%);
            border-radius: 10px;
            box-shadow:
                inset 0 -2px 4px rgba(0,0,0,0.1),
                0 2px 4px rgba(0,0,0,0.1);
        }

        .cup-icon::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10%;
            width: 20px;
            height: 60px;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            border-radius: 50%;
            filter: blur(4px);
        }

        .container-label {
            font-size: 1.5em;
            color: #8b6f47;
            font-weight: 600;
        }

        .selected-tag {
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: #ffd700;
            color: #8b6f47;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .container-card.selected .selected-tag {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Scene 2 - Scoop Count */
        .scoop-section {
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
        }

        .scoop-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
        }

        .scoop-btn {
            background: linear-gradient(135deg, #fff 0%, #ffe5e5 100%);
            border: 3px solid #ffb3ba;
            border-radius: 16px;
            padding: 20px 40px;
            font-size: 1.2em;
            font-weight: 600;
            color: #8b6f47;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .scoop-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .scoop-btn.selected {
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
            border-color: #ff9a3c;
        }

        .ice-cream-display {
            position: relative;
            height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }

        .scoop {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f0f0f0 0%, #d0d0d0 100%);
            box-shadow:
                0 4px 10px rgba(0,0,0,0.15),
                inset -5px -5px 15px rgba(0,0,0,0.1),
                inset 10px 10px 20px rgba(255,255,255,0.5);
            position: absolute;
            opacity: 0;
            animation: dropScoop 0.6s ease forwards;
        }

        .scoop::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 20%;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(4px);
        }

        .scoop::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background:
                radial-gradient(ellipse at 30% 30%, rgba(255,255,255,0.4) 0%, transparent 40%),
                radial-gradient(ellipse at 70% 70%, rgba(0,0,0,0.1) 0%, transparent 50%);
        }

        @keyframes dropScoop {
            0% {
                transform: translateY(-200px) scale(0.5);
                opacity: 0;
            }
            60% {
                transform: translateY(10px) scale(1.1);
                opacity: 1;
            }
            80% {
                transform: translateY(-5px) scale(0.95);
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .scoop-1 {
            bottom: 0;
        }

        .scoop-2 {
            bottom: 80px;
        }

        .scoop-notification {
            position: absolute;
            top: 20px;
            background: #ffd700;
            color: #8b6f47;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: bold;
            opacity: 0;
            animation: popNotification 1s ease forwards;
        }

        @keyframes popNotification {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            20%, 80% { opacity: 1; transform: scale(1); }
        }

        /* Scene 3 - Flavors */
        .flavor-section {
            max-width: 600px;
            margin: 0 auto;
        }

        .flavor-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .flavor-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .flavor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .flavor-card.selected {
            box-shadow: 0 0 0 4px #ffd700;
        }

        .flavor-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            border-radius: 50%;
            background-size: 20px 20px;
        }

        .flavor-strawberry .flavor-icon {
            background: linear-gradient(135deg, #ffb3ba 0%, #ff8a94 100%);
            background-image:
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.3) 2px, transparent 2px),
                radial-gradient(circle at 75% 75%, rgba(255,255,255,0.3) 2px, transparent 2px);
            background-size: 20px 20px;
        }

        .flavor-chocolate .flavor-icon {
            background: linear-gradient(135deg, #8b6f47 0%, #6b4423 100%);
            background-image:
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 2px, transparent 2px),
                radial-gradient(circle at 70% 70%, rgba(255,255,255,0.2) 2px, transparent 2px);
            background-size: 20px 20px;
        }

        .flavor-mint .flavor-icon {
            background: linear-gradient(135deg, #b4e7ce 0%, #87ceae 100%);
            background-image:
                radial-gradient(circle at 40% 40%, rgba(255,255,255,0.3) 2px, transparent 2px),
                radial-gradient(circle at 60% 60%, rgba(255,255,255,0.3) 2px, transparent 2px);
            background-size: 20px 20px;
        }

        .flavor-cream .flavor-icon {
            background: linear-gradient(135deg, #fff8dc 0%, #f5e6d3 100%);
            background-image:
                radial-gradient(circle at 35% 35%, rgba(139,111,71,0.1) 2px, transparent 2px),
                radial-gradient(circle at 65% 65%, rgba(139,111,71,0.1) 2px, transparent 2px);
            background-size: 20px 20px;
        }

        .flavor-label {
            font-size: 1.2em;
            color: #8b6f47;
            font-weight: 600;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #4caf50;
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: bold;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Scene 4 - Decorations */
        .decoration-section {
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
        }

        .decoration-chips {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .decoration-chip {
            background: white;
            border-radius: 30px;
            padding: 15px 30px;
            cursor: move;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #8b6f47;
        }

        .decoration-chip:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .decoration-chip.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .decoration-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }

        .sprinkles-icon {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 50%, #ffa07a 100%);
        }

        .heart-icon {
            background: linear-gradient(135deg, #ff8a94 0%, #ff6b9d 100%);
            clip-path: polygon(50% 20%, 100% 0%, 100% 50%, 50% 100%, 0% 50%, 0% 0%);
        }

        .ribbon-icon {
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
        }

        .whipped-icon {
            background: linear-gradient(135deg, #fffef7 0%, #f5f3e8 100%);
            position: relative;
        }

        .whipped-icon::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f6ed 100%);
            border-radius: 50%;
        }

        .cherry-icon {
            background: radial-gradient(circle, #ff4757 0%, #c92a2a 100%);
            position: relative;
        }

        .cherry-icon::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            width: 2px;
            height: 10px;
            background: #2d3436;
        }

        .sauce-icon {
            background: linear-gradient(135deg, #8b4513 0%, #5c2e0f 100%);
        }

        .wafer-icon {
            background: linear-gradient(135deg, #daa520 0%, #b8860b 100%);
            clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
        }

        .ice-cream-plate {
            position: relative;
            margin: 0 auto;
            width: 300px;
            height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-bottom: 40px;
        }

        .plate {
            position: absolute;
            bottom: 0;
            width: 250px;
            height: 15px;
            background: linear-gradient(180deg, #e0e0e0 0%, #b0b0b0 100%);
            border-radius: 50%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .plate::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 10%;
            right: 10%;
            height: 3px;
            background: rgba(0,0,0,0.1);
            border-radius: 50%;
            filter: blur(3px);
        }

        .drop-zone {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 200px;
            border: 3px dashed transparent;
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .decoration-overlay {
            position: absolute;
            pointer-events: none;
        }

        .confirm-btn {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            border: none;
            border-radius: 16px;
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            cursor: pointer;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
        }

        .confirm-btn.show {
            opacity: 1;
            transform: translateY(0);
            animation: pulse 2s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
            50% { box-shadow: 0 4px 25px rgba(76, 175, 80, 0.5); }
        }

        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        /* Final Scene */
        .final-section {
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
        }

        .final-ice-cream {
            width: 250px;
            height: 300px;
            margin: 0 auto 30px;
            position: relative;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.2));
        }

        .sparkle-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .sparkle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #fff 0%, transparent 70%);
            border-radius: 50%;
            animation: sparkle 1.5s ease infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .summary-text {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: left;
        }

        .summary-text p {
            margin: 10px 0;
            color: #8b6f47;
            font-size: 1.1em;
        }

        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .final-btn {
            background: linear-gradient(135deg, #fff 0%, #ffe5e5 100%);
            border: 3px solid #ffb3ba;
            border-radius: 16px;
            padding: 15px 35px;
            font-size: 1.1em;
            font-weight: bold;
            color: #8b6f47;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .final-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .final-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            transition: left 0.5s ease;
        }

        .final-btn:hover::before {
            left: 100%;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ffd700;
            position: absolute;
            animation: confettiFall 1s ease forwards;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100px) rotate(360deg);
                opacity: 0;
            }
        }

        .sparkle-trail {
            position: fixed;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #ffd700 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: fadeOut 0.5s ease forwards;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: scale(0);
            }
        }

        /* Transitions */
        .slide-left-enter {
            animation: slideLeftEnter 0.4s ease forwards;
        }

        @keyframes slideLeftEnter {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .slide-left-exit {
            animation: slideLeftExit 0.4s ease forwards;
        }

        @keyframes slideLeftExit {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(-100%);
                opacity: 0;
            }
        }

        .slide-vertical-enter {
            animation: slideVerticalEnter 0.4s ease forwards;
        }

        @keyframes slideVerticalEnter {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .fade-enter {
            animation: fadeEnter 0.5s ease forwards;
        }

        @keyframes fadeEnter {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Scene 1: Choose Container -->
        <div id="scene1" class="scene active">
            <h1>üç¶ Choose Your Container</h1>
            <div class="container-grid">
                <div class="container-card" data-container="cone">
                    <div class="container-icon">
                        <div class="cone-icon"></div>
                    </div>
                    <div class="container-label">Cone</div>
                    <div class="selected-tag">Selected! ‚ú®</div>
                </div>
                <div class="container-card" data-container="cup">
                    <div class="container-icon">
                        <div class="cup-icon"></div>
                    </div>
                    <div class="container-label">Cup</div>
                    <div class="selected-tag">Selected! ‚ú®</div>
                </div>
            </div>
        </div>

        <!-- Scene 2: Choose Scoop Count -->
        <div id="scene2" class="scene">
            <h1>üç® How Many Scoops?</h1>
            <div class="scoop-section">
                <div class="scoop-buttons">
                    <button class="scoop-btn" data-scoops="1">Single Scoop</button>
                    <button class="scoop-btn" data-scoops="2">Double Scoop</button>
                </div>
                <div class="ice-cream-display" id="scoopDisplay">
                    <div id="containerDisplay"></div>
                </div>
            </div>
        </div>

        <!-- Scene 3: Choose Flavors -->
        <div id="scene3" class="scene">
            <h1>üé® Choose Your Flavors</h1>
            <div class="flavor-section">
                <div class="flavor-grid">
                    <div class="flavor-card flavor-strawberry" data-flavor="strawberry" data-color="linear-gradient(135deg, #ffb3ba 0%, #ff8a94 100%)">
                        <div class="flavor-icon"></div>
                        <div class="flavor-label">Strawberry</div>
                    </div>
                    <div class="flavor-card flavor-chocolate" data-flavor="chocolate" data-color="linear-gradient(135deg, #8b6f47 0%, #6b4423 100%)">
                        <div class="flavor-icon"></div>
                        <div class="flavor-label">Chocolate</div>
                    </div>
                    <div class="flavor-card flavor-mint" data-flavor="mint" data-color="linear-gradient(135deg, #b4e7ce 0%, #87ceae 100%)">
                        <div class="flavor-icon"></div>
                        <div class="flavor-label">Mint</div>
                    </div>
                    <div class="flavor-card flavor-cream" data-flavor="cream" data-color="linear-gradient(135deg, #fff8dc 0%, #f5e6d3 100%)">
                        <div class="flavor-icon"></div>
                        <div class="flavor-label">Cream</div>
                    </div>
                </div>
                <div id="flavorDisplay"></div>
            </div>
        </div>

        <!-- Scene 4: Decorations -->
        <div id="scene4" class="scene">
            <h1>‚ú® Add Decorations</h1>
            <div class="decoration-section">
                <div class="decoration-chips">
                    <div class="decoration-chip" draggable="true" data-decoration="sprinkles">
                        <div class="decoration-icon sprinkles-icon"></div>
                        <span>Rainbow Sprinkles</span>
                    </div>
                    <div class="decoration-chip" draggable="true" data-decoration="whipped">
                        <div class="decoration-icon whipped-icon"></div>
                        <span>Whipped Cream</span>
                    </div>
                    <div class="decoration-chip" draggable="true" data-decoration="cherry">
                        <div class="decoration-icon cherry-icon"></div>
                        <span>Cherry on Top</span>
                    </div>
                    <div class="decoration-chip" draggable="true" data-decoration="heart">
                        <div class="decoration-icon heart-icon"></div>
                        <span>Heart Candy</span>
                    </div>
                    <div class="decoration-chip" draggable="true" data-decoration="sauce">
                        <div class="decoration-icon sauce-icon"></div>
                        <span>Chocolate Sauce</span>
                    </div>
                    <div class="decoration-chip" draggable="true" data-decoration="wafer">
                        <div class="decoration-icon wafer-icon"></div>
                        <span>Wafer Cookie</span>
                    </div>
                </div>
                <div class="ice-cream-plate">
                    <div class="drop-zone" id="dropZone">
                        <div id="decorationDisplay"></div>
                    </div>
                    <div class="plate"></div>
                </div>
                <button class="confirm-btn" id="confirmBtn">Complete Your Creation! üéâ</button>
            </div>
        </div>

        <!-- Final Scene: Summary -->
        <div id="scene5" class="scene">
            <h1>üéâ Your Delicious Creation!</h1>
            <div class="final-section">
                <div class="final-ice-cream" id="finalDisplay">
                    <div class="sparkle-overlay" id="sparkleOverlay"></div>
                </div>
                <div class="summary-text" id="summaryText">
                </div>
                <div class="final-buttons">
                    <button class="final-btn" id="remakeBtn">üîÑ Remake</button>
                    <button class="final-btn" id="shareBtn">üì§ Share</button>
                </div>
            </div>
        </div>

        <!-- Toast notification -->
        <div class="toast" id="toast"></div>
    </div>

    <script>
        // State management
        const state = {
            container: null,
            scoopCount: 0,
            flavors: [],
            decorations: []
        };

        let currentScene = 1;

        // Scene transition
        function transitionToScene(sceneNumber, animationClass = 'slide-left-enter') {
            const currentSceneEl = document.getElementById(`scene${currentScene}`);
            const nextSceneEl = document.getElementById(`scene${sceneNumber}`);

            currentSceneEl.classList.remove('active');

            setTimeout(() => {
                nextSceneEl.classList.add('active', animationClass);
                currentScene = sceneNumber;

                // Initialize scene-specific functionality
                if (sceneNumber === 2) initScene2();
                if (sceneNumber === 3) initScene3();
                if (sceneNumber === 4) initScene4();
                if (sceneNumber === 5) initScene5();
            }, 100);
        }

        // Scene 1: Container selection
        document.querySelectorAll('.container-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.container-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                state.container = this.dataset.container;

                setTimeout(() => {
                    transitionToScene(2, 'slide-left-enter');
                }, 800);
            });
        });

        // Scene 2: Scoop count
        function initScene2() {
            const containerDisplay = document.getElementById('containerDisplay');

            // Show container
            if (state.container === 'cone') {
                containerDisplay.innerHTML = '<div class="cone-icon"></div>';
            } else {
                containerDisplay.innerHTML = '<div class="cup-icon"></div>';
            }

            document.querySelectorAll('.scoop-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.scoop-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    const scoopCount = parseInt(this.dataset.scoops);
                    state.scoopCount = scoopCount;

                    // Show scoops
                    const display = document.getElementById('scoopDisplay');
                    const existingScoops = display.querySelectorAll('.scoop');
                    existingScoops.forEach(s => s.remove());

                    for (let i = 0; i < scoopCount; i++) {
                        setTimeout(() => {
                            const scoop = document.createElement('div');
                            scoop.className = `scoop scoop-${i + 1}`;
                            scoop.style.bottom = (i * 80) + 'px';
                            display.appendChild(scoop);

                            // Show notification
                            const notification = document.createElement('div');
                            notification.className = 'scoop-notification';
                            notification.textContent = '+ 1 Scoop!';
                            notification.style.top = '20px';
                            display.appendChild(notification);

                            setTimeout(() => notification.remove(), 1000);
                        }, i * 300);
                    }

                    setTimeout(() => {
                        transitionToScene(3, 'slide-vertical-enter');
                    }, scoopCount * 300 + 800);
                });
            });
        }

        // Scene 3: Flavor selection
        function initScene3() {
            let selectedCount = 0;

            document.querySelectorAll('.flavor-card').forEach(card => {
                card.addEventListener('click', function() {
                    if (selectedCount >= state.scoopCount) {
                        showToast('All scoops have flavors! Moving on...');
                        return;
                    }

                    this.classList.add('selected');
                    const flavor = this.dataset.flavor;
                    const color = this.dataset.color;
                    state.flavors.push({ flavor, color });
                    selectedCount++;

                    showToast(`Flavor locked in! üéâ`);

                    if (selectedCount === state.scoopCount) {
                        setTimeout(() => {
                            transitionToScene(4, 'fade-enter');
                        }, 500);
                    }
                });
            });
        }

        // Scene 4: Decorations
        function initScene4() {
            const decorationDisplay = document.getElementById('decorationDisplay');
            const dropZone = document.getElementById('dropZone');
            const confirmBtn = document.getElementById('confirmBtn');

            // Rebuild ice cream with flavors
            decorationDisplay.innerHTML = '';
            for (let i = 0; i < state.scoopCount; i++) {
                const scoop = document.createElement('div');
                scoop.className = `scoop scoop-${i + 1}`;
                scoop.style.bottom = (i * 80) + 'px';
                scoop.style.background = state.flavors[i].color;
                scoop.style.animation = 'none';
                scoop.style.opacity = '1';
                decorationDisplay.appendChild(scoop);
            }

            // Add container
            if (state.container === 'cone') {
                const cone = document.createElement('div');
                cone.className = 'cone-icon';
                cone.style.position = 'absolute';
                cone.style.bottom = '-60px';
                decorationDisplay.appendChild(cone);
            } else {
                const cup = document.createElement('div');
                cup.className = 'cup-icon';
                cup.style.position = 'absolute';
                cup.style.bottom = '-60px';
                decorationDisplay.appendChild(cup);
            }

            // Drag and drop
            let draggedElement = null;

            document.querySelectorAll('.decoration-chip').forEach(chip => {
                chip.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });

                chip.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                });
            });

            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');

                if (draggedElement) {
                    const decoration = draggedElement.dataset.decoration;

                    // Check if already added
                    if (!state.decorations.includes(decoration)) {
                        state.decorations.push(decoration);

                        // Create decoration overlay
                        const overlay = document.createElement('div');
                        overlay.className = 'decoration-overlay';
                        overlay.style.cssText = `
                            width: 100px;
                            height: 100px;
                            top: ${Math.random() * 100}px;
                            left: ${Math.random() * 100}px;
                            font-size: 2em;
                            animation: dropScoop 0.6s ease forwards;
                        `;

                        if (decoration === 'sprinkles') {
                            overlay.innerHTML = '<div style="font-size: 0.5em; display: flex; flex-wrap: wrap; gap: 3px;">üü•üü¶üü®üü©üü™üüßüü•üü¶üü®üü©</div>';
                        } else if (decoration === 'whipped') {
                            overlay.innerHTML = '<div style="width: 80px; height: 60px; background: linear-gradient(135deg, #fffef7 0%, #f5f3e8 100%); border-radius: 50% 50% 40% 40%; box-shadow: inset -3px -3px 8px rgba(0,0,0,0.1), 0 4px 8px rgba(0,0,0,0.2);"></div>';
                        } else if (decoration === 'cherry') {
                            overlay.innerHTML = '<div style="position: relative;"><div style="width: 25px; height: 25px; background: radial-gradient(circle, #ff4757 0%, #c92a2a 100%); border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.3), inset -2px -2px 5px rgba(0,0,0,0.2), inset 3px 3px 8px rgba(255,255,255,0.4);"></div><div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 3px; height: 20px; background: linear-gradient(180deg, #2d3436 0%, #636e72 100%); border-radius: 2px;"></div></div>';
                        } else if (decoration === 'heart') {
                            overlay.textContent = 'üíñ';
                        } else if (decoration === 'sauce') {
                            overlay.innerHTML = '<div style="width: 100px; height: 80px; background: linear-gradient(180deg, transparent 0%, #8b4513 60%, #5c2e0f 100%); border-radius: 50%; opacity: 0.8; filter: blur(1px);"></div>';
                        } else if (decoration === 'wafer') {
                            overlay.innerHTML = '<div style="width: 8px; height: 100px; background: repeating-linear-gradient(45deg, #daa520 0px, #daa520 5px, #b8860b 5px, #b8860b 10px); border-radius: 4px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); transform: rotate(-20deg);"></div>';
                        }

                        decorationDisplay.appendChild(overlay);

                        // Create confetti
                        createConfetti(e.clientX, e.clientY);

                        // Show confirm button
                        confirmBtn.classList.add('show');
                    }
                }
            });

            confirmBtn.addEventListener('click', function() {
                transitionToScene(5, 'fade-enter');
            });
        }

        // Scene 5: Final summary
        function initScene5() {
            const finalDisplay = document.getElementById('finalDisplay');
            const summaryText = document.getElementById('summaryText');
            const sparkleOverlay = document.getElementById('sparkleOverlay');

            // Rebuild final ice cream
            finalDisplay.innerHTML = '';
            const iceCreamContainer = document.createElement('div');
            iceCreamContainer.style.cssText = 'position: relative; width: 100%; height: 100%;';

            for (let i = 0; i < state.scoopCount; i++) {
                const scoop = document.createElement('div');
                scoop.className = 'scoop';
                scoop.style.cssText = `
                    position: absolute;
                    bottom: ${i * 80 + 60}px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${state.flavors[i].color};
                    animation: none;
                    opacity: 1;
                `;
                iceCreamContainer.appendChild(scoop);
            }

            // Add decorations
            state.decorations.forEach((decoration, index) => {
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: absolute;
                    top: ${index * 40 + 20}px;
                    left: ${50 + (index - 1) * 30}%;
                    transform: translateX(-50%);
                    font-size: 2em;
                `;

                if (decoration === 'sprinkles') {
                    overlay.innerHTML = '<div style="font-size: 0.4em; display: flex; flex-wrap: wrap; gap: 2px;">üü•üü¶üü®üü©üü™üüßüü•üü¶</div>';
                } else if (decoration === 'whipped') {
                    overlay.innerHTML = '<div style="width: 60px; height: 45px; background: linear-gradient(135deg, #fffef7 0%, #f5f3e8 100%); border-radius: 50% 50% 40% 40%; box-shadow: inset -3px -3px 8px rgba(0,0,0,0.1), 0 4px 8px rgba(0,0,0,0.2);"></div>';
                } else if (decoration === 'cherry') {
                    overlay.innerHTML = '<div style="position: relative;"><div style="width: 20px; height: 20px; background: radial-gradient(circle, #ff4757 0%, #c92a2a 100%); border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.3), inset -2px -2px 5px rgba(0,0,0,0.2), inset 3px 3px 8px rgba(255,255,255,0.4);"></div><div style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); width: 2px; height: 15px; background: linear-gradient(180deg, #2d3436 0%, #636e72 100%); border-radius: 2px;"></div></div>';
                } else if (decoration === 'heart') {
                    overlay.textContent = 'üíñ';
                } else if (decoration === 'sauce') {
                    overlay.innerHTML = '<div style="width: 80px; height: 60px; background: linear-gradient(180deg, transparent 0%, #8b4513 60%, #5c2e0f 100%); border-radius: 50%; opacity: 0.8; filter: blur(1px);"></div>';
                } else if (decoration === 'wafer') {
                    overlay.innerHTML = '<div style="width: 6px; height: 80px; background: repeating-linear-gradient(45deg, #daa520 0px, #daa520 4px, #b8860b 4px, #b8860b 8px); border-radius: 3px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); transform: rotate(-20deg);"></div>';
                }

                iceCreamContainer.appendChild(overlay);
            });

            // Add container
            if (state.container === 'cone') {
                const cone = document.createElement('div');
                cone.className = 'cone-icon';
                cone.style.cssText = 'position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);';
                iceCreamContainer.appendChild(cone);
            } else {
                const cup = document.createElement('div');
                cup.className = 'cup-icon';
                cup.style.cssText = 'position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);';
                iceCreamContainer.appendChild(cup);
            }

            finalDisplay.appendChild(iceCreamContainer);

            // Add sparkles
            for (let i = 0; i < 8; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.cssText = `
                    top: ${Math.random() * 100}%;
                    left: ${Math.random() * 100}%;
                    animation-delay: ${Math.random() * 1.5}s;
                `;
                sparkleOverlay.appendChild(sparkle);
            }

            // Summary text
            const containerEmoji = state.container === 'cone' ? 'üç¶' : 'ü•§';
            const flavorNames = state.flavors.map(f => f.flavor.charAt(0).toUpperCase() + f.flavor.slice(1)).join(', ');
            const decorationNames = state.decorations.map(d => {
                if (d === 'sprinkles') return 'Rainbow Sprinkles üåà';
                if (d === 'whipped') return 'Whipped Cream üç¶';
                if (d === 'cherry') return 'Cherry on Top üçí';
                if (d === 'heart') return 'Heart Candy üíñ';
                if (d === 'sauce') return 'Chocolate Sauce üç´';
                if (d === 'wafer') return 'Wafer Cookie üç™';
            }).join(', ') || 'None';

            summaryText.innerHTML = `
                <p><strong>Container:</strong> ${containerEmoji} ${state.container.charAt(0).toUpperCase() + state.container.slice(1)}</p>
                <p><strong>Scoops:</strong> ${state.scoopCount} ${state.scoopCount === 1 ? 'scoop' : 'scoops'}</p>
                <p><strong>Flavors:</strong> ${flavorNames}</p>
                <p><strong>Decorations:</strong> ${decorationNames}</p>
            `;

            // Buttons
            document.getElementById('remakeBtn').addEventListener('click', function() {
                location.reload();
            });

            document.getElementById('shareBtn').addEventListener('click', function() {
                showToast('Your creation is ready to share! üéâ');
            });
        }

        // Helper functions
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        function createConfetti(x, y) {
            const colors = ['#ffd700', '#ff6b9d', '#87ceae', '#ffb3ba', '#a8d8ea'];

            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.cssText = `
                    position: fixed;
                    left: ${x}px;
                    top: ${y}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    animation-delay: ${Math.random() * 0.2}s;
                    transform: rotate(${Math.random() * 360}deg);
                `;
                document.body.appendChild(confetti);

                setTimeout(() => confetti.remove(), 1000);
            }
        }

        // Sparkle trail for dragging (optional enhancement)
        document.addEventListener('dragover', function(e) {
            if (document.querySelector('.decoration-chip.dragging')) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle-trail';
                sparkle.style.left = e.clientX + 'px';
                sparkle.style.top = e.clientY + 'px';
                document.body.appendChild(sparkle);

                setTimeout(() => sparkle.remove(), 500);
            }
        });
    </script>
</body>
</html>
